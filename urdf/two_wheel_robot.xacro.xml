<?xml version="1.0"?>

<robot name="jetbot_model" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Global namespace -->
  <xacro:arg name="robot_name" default="car_1" />
  <xacro:arg name="robot_skin" default="Blue" />

  <!-- inertial parameter macros -->

  <xacro:macro name="chassis_inertial_params">
    <origin xyz="0.1477 0 0" rpy="0 0 0" />
    <mass value="4.0" />
    <inertia ixx="0.010609" ixy="0"          ixz="0"
                            iyy="0.050409"   iyz="0"
                                             izz="0.05865" />
  </xacro:macro>

  <xacro:macro name="left_wheel_inertial_params">
    <origin xyz="0 0 -0.0225" rpy="0 0 0" />
    <mass value="0.34055" />
    <inertia ixx="0.00026046" ixy="0"          ixz="0"
                              iyy="0.00026046" iyz="0"
                                               izz="0.00041226" />
  </xacro:macro>

  <xacro:macro name="right_wheel_inertial_params">
    <origin xyz="0 0 0.0225" rpy="0 0 0" />
    <mass value="0.34055" />
    <inertia ixx="0.00026046" ixy="0"          ixz="0"
                              iyy="0.00026046" iyz="0"
                                               izz="0.00041226" />
  </xacro:macro>
  
  <xacro:macro name="chassis_geometry">
    <geometry>
      <box size=".4 .2 .1"/>
    </geometry>
  </xacro:macro>

  
  <xacro:macro name="chassis_collision">      
    <geometry>
      <box size=".4 .2 .1"/>
    </geometry>
  </xacro:macro>
 
  <xacro:macro name="caster_geometry">
   <origin xyz="-0.15 0 -0.05" rpy="0 0 0"/>
   <geometry>
      <sphere radius=".05"/>
   </geometry>
  </xacro:macro>
  <xacro:macro name="caster_surface">
    <surface>
      <friction>
	<ode>
	  <mu>0</mu>
	  <mu2>0</mu2>
	  <slip1>1.0</slip1>
	  <slip2>1.0</slip2>
	</ode>
      </friction>
    </surface>
  </xacro:macro>
  <xacro:macro name="wheel_geometry">
    <geometry>
      <cylinder radius="0.1" length="0.05"/>
    </geometry>
  </xacro:macro>


  <xacro:macro name="wheel_transmission" params="name">
    <transmission name="${name}_transmission" type="SimpleTransmission">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="${name}_joint">
        <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
      </joint>
      <actuator name="${name}_motor">
        <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>
  
  <!-- Now the robot description-->
  
  <link name="chassis">
    <origin xyz="0 0 .1" rpy="0 0 0"/>
    <collision name='collision'>
      <xacro:chassis_collision/>
    </collision>
    <visual name='visual'>
      <xacro:chassis_geometry/>
    </visual>

    <collision name='caster-collision'>
      <xacro:caster_geometry/>
    <!--  <surface>
       <xacro:caster_surface/>
      </surface> -->
    </collision>

    <visual name='caster_visual'>
     <xacro:caster_geometry/>
    </visual>
  </link>

  <link name="left_wheel">
    <origin xyz=" 0.1 0.13 0.1" rpy=" 0 1.5707 1.5707"/>
    <collision name="collision">
      <xacro:wheel_geometry/>
    </collision>
    <visual name="visual">
      <xacro:wheel_geometry/>
    </visual>
    <inertial>
      <xacro:left_wheel_inertial_params/>
    </inertial>
  </link>
  
  <link name="right_wheel">    
    <origin xyz="0.1 -0.13 0.1" rpy="0 1.5707 1.5707"/>
    <collision name="collision">
      <xacro:wheel_geometry/>
    </collision>
    <visual name="visual">
      <xacro:wheel_geometry/>
    </visual>
    <inertial>
      <xacro:right_wheel_inertial_params/>
  </link>

  <joint type="revolute" name="left_wheel_joint">
    <origin xyz="0 0 -0.03" rpy="0 0 0"/> 
    <child link="left_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0"/>
  </joint>
  <xacro:wheel_transmission name="$(arg robot_name)_left_wheel"/>
  <joint type="revolute" name="right_wheel_joint">
    <origin xyz="0 0 0.03" rpy="0 0 0"/>
    <child link="right_wheel"/>
    <parent link="chassis"/>
    <axis xyz="0 1 0"/>
  </joint>  
  <xacro:wheel_transmission name="$(arg robot_name)_right_wheel"/>
</robot>
